# Reentrancy Vulnerability of Smart Contracts

## Overview
A **Reentrancy Vulnerability** occurs when a function sends Ether (`call.value`) before updating the user’s balance, allowing an attacker to recursively call the function and drain funds before the balance is updated.

## Vulnerability Detection Criteria
A function is considered vulnerable if it meets the following conditions:

1. **callValueInvocation**: The function uses `call.value`, which allows external calls.
2. **balanceDeduction**: The balance is not deducted before the money transfer.
3. **zeroParameter**: The function does not have a zero-value `call.value` parameter.
4. **ModifierConstrain**: The function is not protected by the `onlyOwner` modifier.

A function is labeled vulnerable (`label = 1`) if:

**`callValueInvocation ∧ !balanceDeduction ∧ !zeroParameter ∧ !ModifierConstrain`**

---

## Examples of Vulnerable Cases

### 1. Reentrancy Without Balance Deduction
The function `forwardFunds` sends Ether using `call.value` before updating the balance. This allows an attacker to call the function multiple times before the balance is updated.

![image](https://github.com/user-attachments/assets/bf7094d9-e717-4ed4-bc22-e4b9206ed574)

- **Issue**: Balance is updated after sending funds (line 6).
- **Risk**: An attacker can re-enter the function before the balance is updated.
- **Label**: 1 (Vulnerable)

---

## Examples of Safe Cases (Not Vulnerable)

### 1. Safe Use of `call.value` with Zero Parameter
The function `transfer` uses `call.value(0)`, meaning no actual funds are transferred, making reentrancy impossible.

![image](https://github.com/user-attachments/assets/0472caa7-5dd4-4b09-96dc-7278c820aed3)

- **Issue**: None, since no real funds are transferred.
- **Label**: 0 (Safe)

### 2. Deducting Balance Before `call.value`
The function `transfer` properly deducts the sender's balance before calling `call.value`, making it safe from reentrancy.

![image](https://github.com/user-attachments/assets/fd5b7c18-95a8-4972-8ed8-6eb9a5e11c13)

- **Fix**: Balance is deducted before sending Ether (line 6).
- **Label**: 0 (Safe)

### 3. Protecting Function with `onlyOwner` Modifier
The function `forwardFunds` is constrained by `onlyOwner`, preventing external attackers from calling it.

![image](https://github.com/user-attachments/assets/f3de4345-398c-4425-a6a5-ec25b11297f0)

- **Fix**: Only the contract owner can call `forwardFunds` (line 10).
- **Label**: 0 (Safe)

---

## Summary

A function has a **Reentrancy Vulnerability** if:
- It sends Ether (`call.value`) before updating balances, allowing multiple reentries.
- It does not check parameters or restrict access (`onlyOwner`).

A function is **Safe** if:
- It deducts balances before transferring Ether.
- It restricts access using the `onlyOwner` modifier.
- It uses `call.value(0)` to prevent unintended transfers.
